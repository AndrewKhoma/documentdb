SET search_path TO helio_api_catalog;
SET citus.next_shard_id TO 1040000;
SET helio_api.next_collection_id TO 10400;
SET helio_api.next_collection_index_id TO 10400;
-- Set configs to something reasonable for testing.
set helio_api.indexTermLimitOverride to 50;
SET helio_api.enableIndexTermTruncationOnNestedObjects to on;
---------------------------------------------------------------------
---- Nested Array
---------------------------------------------------------------------
--  gin_bson_get_single_path_generated_terms(
--  		document bson,
--  		path text,
--  		isWildcard bool,
--   		generateNotFoundTerm bool default false,
--   		addMetadata bool default false,
--   		termLength int)
-- non wild card
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : [["abcdefghijklmonpqrstuvwsyz"]]}', 'ikey', false, true, true, 50) term;
 length |                          term                          
---------------------------------------------------------------------
     47 | { "$" : [ [ "abcdefghijklmonpqr" ] ], "t" : true }
     47 | { "$" : [ "abcdefghijklmonpqrstuvwsyz" ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : [[1]]}', 'ikey', false, true, true, 50) term;
 length |                         term                          
---------------------------------------------------------------------
     28 | { "$" : [ [ { "$numberInt" : "1" } ] ], "t" : false }
     20 | { "$" : [ { "$numberInt" : "1" } ], "t" : false }
      8 | { "" : true, "t" : false }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[{ "$numberDecimal" : "1234567891011" }]]}', 'ikey', false, true, true, 50) term;
 length |                               term                                
---------------------------------------------------------------------
     32 | { "$" : [ [ { "$numberLong" : "1234567891011" } ] ], "t" : true }
     24 | { "$" : [ { "$numberLong" : "1234567891011" } ], "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[true]]}', 'ikey', false, true, true, 50) term;
 length |                term                 
---------------------------------------------------------------------
     25 | { "$" : [ [ true ] ], "t" : false }
     17 | { "$" : [ true ], "t" : false }
      8 | { "" : true, "t" : false }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : [["abcdefghijklmonpqrstuvwsyz"]]}', 'ikey', false, true, true, 35) term;
 length |                   term                   
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     33 | { "$" : [ "abcdefghijkl" ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : [[1]]}', 'ikey', false, true, true, 35) term;
 length |                       term                       
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     20 | { "$" : [ { "$numberInt" : "1" } ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[{ "$numberDecimal" : "1234567891011" }]]}', 'ikey', false, true, true, 35) term;
 length |                             term                              
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     24 | { "$" : [ { "$numberLong" : "1234567891011" } ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[true]]}', 'ikey', false, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     17 | { "$" : [ true ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

-- wild card
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : [["abcdefghijklmonpqrstuvwsyz"]]}', 'ikey', true, true, true, 50) term;
 length |                          term                           
---------------------------------------------------------------------
     47 | { "$" : [ [ "abcdefghijklmonpqr" ] ], "t" : true }
     48 | { "$.0" : [ "abcdefghijklmonpqrstuvwsy" ], "t" : true }
     43 | { "$.0.0" : "abcdefghijklmonpqrstuvwsyz", "t" : false }
     47 | { "$" : [ "abcdefghijklmonpqrstuvwsyz" ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : [[1]]}', 'ikey', true, true, true, 50) term;
 length |                         term                          
---------------------------------------------------------------------
     28 | { "$" : [ [ { "$numberInt" : "1" } ] ], "t" : false }
     22 | { "$.0" : [ { "$numberInt" : "1" } ], "t" : false }
     16 | { "$.0.0" : { "$numberInt" : "1" }, "t" : false }
     20 | { "$" : [ { "$numberInt" : "1" } ], "t" : false }
      8 | { "" : true, "t" : false }
     12 | { "" : [  ], "t" : false }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[{ "$numberDecimal" : "1234567891011" }]]}', 'ikey', true, true, true, 50) term;
 length |                               term                                
---------------------------------------------------------------------
     32 | { "$" : [ [ { "$numberLong" : "1234567891011" } ] ], "t" : true }
     26 | { "$.0" : [ { "$numberLong" : "1234567891011" } ], "t" : false }
     28 | { "$.0.0" : { "$numberDecimal" : "1234567891011" }, "t" : false }
     24 | { "$" : [ { "$numberLong" : "1234567891011" } ], "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[true]]}', 'ikey', true, true, true, 50) term;
 length |                term                 
---------------------------------------------------------------------
     25 | { "$" : [ [ true ] ], "t" : false }
     19 | { "$.0" : [ true ], "t" : false }
     13 | { "$.0.0" : true, "t" : false }
     17 | { "$" : [ true ], "t" : false }
      8 | { "" : true, "t" : false }
     12 | { "" : [  ], "t" : false }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : [["abcdefghijklmonpqrstuvwsyz"]]}', 'ikey', true, true, true, 35) term;
 length |                      term                      
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     15 | { "$.0" : [  ], "t" : true }
     35 | { "$.0.0" : "abcdefghijklmonpqr", "t" : true }
     33 | { "$" : [ "abcdefghijkl" ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : [[1]]}', 'ikey', true, true, true, 35) term;
 length |                       term                        
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     15 | { "$.0" : [  ], "t" : true }
     16 | { "$.0.0" : { "$numberInt" : "1" }, "t" : false }
     20 | { "$" : [ { "$numberInt" : "1" } ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[{ "$numberDecimal" : "1234567891011" }]]}', 'ikey', true, true, true, 35) term;
 length |                               term                                
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     15 | { "$.0" : [  ], "t" : true }
     28 | { "$.0.0" : { "$numberDecimal" : "1234567891011" }, "t" : false }
     24 | { "$" : [ { "$numberLong" : "1234567891011" } ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : [[true]]}', 'ikey', true, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : [ [  ] ], "t" : true }
     15 | { "$.0" : [  ], "t" : true }
     13 | { "$.0.0" : true, "t" : false }
     17 | { "$" : [ true ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(7 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : [["abcdefghijklmonpqrstuvwsyz"]]}', 'ikey', false, true, true, 50) term;
 length |                          term                          
---------------------------------------------------------------------
     47 | { "$" : [ [ "abcdefghijklmonpqr" ] ], "t" : true }
     47 | { "$" : [ "abcdefghijklmonpqrstuvwsyz" ], "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(4 rows)

SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "index_truncation_tests_nested_array", "indexes": [ { "key": { "ikey": 1 }, "name": "ikey_1", "enableLargeIndexKeys": true } ] }');
NOTICE:  creating collection
                                                                                                   create_indexes_non_concurrently                                                                                                   
---------------------------------------------------------------------
 { "raw" : { "defaultShard" : { "numIndexesBefore" : { "$numberInt" : "1" }, "numIndexesAfter" : { "$numberInt" : "2" }, "createdCollectionAutomatically" : true, "ok" : { "$numberInt" : "1" } } }, "ok" : { "$numberInt" : "1" } }
(1 row)

-- now we have an index with truncation enabled and 50 chars.
\d helio_data.documents_10400;
                     Table "helio_data.documents_10400"
     Column      |           Type           | Collation | Nullable | Default 
---------------------------------------------------------------------
 shard_key_value | bigint                   |           | not null | 
 object_id       | helio_core.bson          |           | not null | 
 document        | helio_core.bson          |           | not null | 
 creation_time   | timestamp with time zone |           | not null | now()
Indexes:
    "collection_pk_10400" PRIMARY KEY, btree (shard_key_value, object_id)
    "documents_rum_index_10401" helio_rum (document bson_rum_single_path_ops (path=ikey, tl='50'))
Check constraints:
    "shard_key_value_check" CHECK (shard_key_value = '10400'::bigint)

-- now insert some documents that does exceed the index term limit.
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 1, "ikey": [["abcdefghijklmonpqrstuvwsyz"]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 2, "ikey": [[1]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 3, "ikey": [[{ "$numberDecimal" : "1234567891011" }]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 4, "ikey": [[true]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 5, "ikey": [[[]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 6, "ikey": [[{}]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[1]] } }';
                                          document                                           
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "3" }, "ikey" : [ [ { "$numberDecimal" : "1234567891011" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
(5 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[false]] } }';
                         document                          
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[[]]] } }';
                         document                          
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
(1 row)

-- now insert some documents that does exceed the index term limit.
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 7, "ikey": [[["abcdefghijklmonpqrstuvwsyz"]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 8, "ikey": [[[1]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 9, "ikey": [[[{ "$numberDecimal" : "1234567891011" }]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 10, "ikey": [[[true]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 11, "ikey": [[[[]]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 12, "ikey": [[[{}]]] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[[1]]] } }';
                                            document                                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "9" }, "ikey" : [ [ [ { "$numberDecimal" : "1234567891011" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
(6 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[[{ "$numberDecimal" : "1234567891011" }]]] } }';
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
(5 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[[false]]] } }';
                            document                            
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [[[[]]]] } }';
                            document                            
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
(2 rows)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 13, "ikey": "abcdefghijklmonpqrstuvwsyz" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 14, "ikey": 1 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 15, "ikey": { "$numberDecimal" : "1234567891011" } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 16, "ikey": true }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 17, "ikey": [] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_array', '{ "_id": 18, "ikey": {} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": 1 } }';
                                       document                                       
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": { "$numberDecimal" : "1234567891011" } } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": false } }';
                      document                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$gt": [] } }';
                                            document                                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "3" }, "ikey" : [ [ { "$numberDecimal" : "1234567891011" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "9" }, "ikey" : [ [ [ { "$numberDecimal" : "1234567891011" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
(12 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$in": [1, true] } }';
                               document                               
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$nin": [1, true] } }';
                                            document                                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "3" }, "ikey" : [ [ { "$numberDecimal" : "1234567891011" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "9" }, "ikey" : [ [ [ { "$numberDecimal" : "1234567891011" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(16 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$elemMatch": { "$in": [1, true] } } }'; 
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$elemMatch": { "$in": [[[1]], [[true]]] } } }'; 
                                    document                                     
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$elemMatch": { "$in": [[[1]], [[true]]], "$gt": [[{ "$numberDecimal" : "1234567891011" }]] } } }'; 
                            document                            
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$all": [[[1]]] } }'; 
                                    document                                     
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$all": [[[[]]]] } }'; 
                            document                            
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$ne": { "$numberDecimal" : "1234567891011" } } }';
                                            document                                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "3" }, "ikey" : [ [ { "$numberDecimal" : "1234567891011" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "9" }, "ikey" : [ [ [ { "$numberDecimal" : "1234567891011" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(17 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$in": [[[1]], [[true]]] } }';
                                    document                                     
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
(4 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$nin": [[[1]], [[true]]] } }';
                                            document                                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "3" }, "ikey" : [ [ { "$numberDecimal" : "1234567891011" } ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "9" }, "ikey" : [ [ [ { "$numberDecimal" : "1234567891011" } ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(14 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_array') WHERE document @@ '{ "ikey": { "$ne": [[{ "$numberDecimal" : "1234567891011" }]] } }';
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] }
 { "_id" : { "$numberInt" : "2" }, "ikey" : [ [ { "$numberInt" : "1" } ] ] }
 { "_id" : { "$numberInt" : "4" }, "ikey" : [ [ true ] ] }
 { "_id" : { "$numberInt" : "5" }, "ikey" : [ [ [  ] ] ] }
 { "_id" : { "$numberInt" : "6" }, "ikey" : [ [ {  } ] ] }
 { "_id" : { "$numberInt" : "7" }, "ikey" : [ [ [ "abcdefghijklmonpqrstuvwsyz" ] ] ] }
 { "_id" : { "$numberInt" : "8" }, "ikey" : [ [ [ { "$numberInt" : "1" } ] ] ] }
 { "_id" : { "$numberInt" : "10" }, "ikey" : [ [ [ true ] ] ] }
 { "_id" : { "$numberInt" : "11" }, "ikey" : [ [ [ [  ] ] ] ] }
 { "_id" : { "$numberInt" : "12" }, "ikey" : [ [ [ {  } ] ] ] }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(16 rows)

---------------------------------------------------------------------
---- Nested Documents
---------------------------------------------------------------------
--  gin_bson_get_single_path_generated_terms(
--  		document bson,
--  		path text,
--  		isWildcard bool,
--   		generateNotFoundTerm bool default false,
--   		addMetadata bool default false,
--   		termLength int)
-- non wild card
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : { "a" : ["abcdefghijklmonpqrstuvwsyz"]}}', 'ikey', false, true, true, 50) term;
 length |                          term                           
---------------------------------------------------------------------
     46 | { "$" : { "a" : [ "abcdefghijklmonpq" ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : { "a" : [1]}}', 'ikey', false, true, true, 50) term;
 length |                            term                            
---------------------------------------------------------------------
     28 | { "$" : { "a" : [ { "$numberInt" : "1" } ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [{ "$numberDecimal" : "1234567891011" }]}}', 'ikey', false, true, true, 50) term;
 length |                                  term                                   
---------------------------------------------------------------------
     32 | { "$" : { "a" : [ { "$numberLong" : "1234567891011" } ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [true]}}', 'ikey', false, true, true, 50) term;
 length |                   term                    
---------------------------------------------------------------------
     25 | { "$" : { "a" : [ true ] }, "t" : false }
      8 | { "" : true, "t" : false }
(2 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : { "a" : ["abcdefghijklmonpqrstuvwsyz"]}}', 'ikey', false, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : { "a" : [1]}}', 'ikey', false, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [{ "$numberDecimal" : "1234567891011" }]}}', 'ikey', false, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [true]}}', 'ikey', false, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

-- wild card
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : { "a" : ["abcdefghijklmonpqrstuvwsyz"]}}', 'ikey', true, true, true, 50) term;
 length |                          term                           
---------------------------------------------------------------------
     46 | { "$" : { "a" : [ "abcdefghijklmonpq" ] }, "t" : true }
     48 | { "$.a" : [ "abcdefghijklmonpqrstuvwsy" ], "t" : true }
     43 | { "$.a.0" : "abcdefghijklmonpqrstuvwsyz", "t" : false }
     41 | { "$.a" : "abcdefghijklmonpqrstuvwsyz", "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : { "a" : [1]}}', 'ikey', true, true, true, 50) term;
 length |                            term                            
---------------------------------------------------------------------
     28 | { "$" : { "a" : [ { "$numberInt" : "1" } ] }, "t" : true }
     22 | { "$.a" : [ { "$numberInt" : "1" } ], "t" : false }
     16 | { "$.a.0" : { "$numberInt" : "1" }, "t" : false }
     14 | { "$.a" : { "$numberInt" : "1" }, "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [{ "$numberDecimal" : "1234567891011" }]]}}', 'ikey', true, true, true, 50) term;
ERROR:  invalid input syntax JSON for BSON: Code: '1', Message 'Got parse error at "]", position 68: "BRACKET_MISMATCH"'
LINE 1: ..._helpers.gin_bson_get_single_path_generated_terms('{"_id": 3...
                                                             ^
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [true]}}', 'ikey', true, true, true, 50) term;
 length |                   term                    
---------------------------------------------------------------------
     25 | { "$" : { "a" : [ true ] }, "t" : false }
     19 | { "$.a" : [ true ], "t" : false }
     13 | { "$.a.0" : true, "t" : false }
     11 | { "$.a" : true, "t" : false }
      8 | { "" : true, "t" : false }
(5 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : { "a" : ["abcdefghijklmonpqrstuvwsyz"]}}', 'ikey', true, true, true, 35) term;
 length |                      term                      
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
     15 | { "$.a" : [  ], "t" : true }
     35 | { "$.a.0" : "abcdefghijklmonpqr", "t" : true }
     35 | { "$.a" : "abcdefghijklmonpqrst", "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 2, "ikey" : { "a" : [1]}}', 'ikey', true, true, true, 35) term;
 length |                       term                        
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
     15 | { "$.a" : [  ], "t" : true }
     16 | { "$.a.0" : { "$numberInt" : "1" }, "t" : false }
     14 | { "$.a" : { "$numberInt" : "1" }, "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [{ "$numberDecimal" : "1234567891011" }]}}', 'ikey', true, true, true, 35) term;
 length |                               term                                
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
     15 | { "$.a" : [  ], "t" : true }
     28 | { "$.a.0" : { "$numberDecimal" : "1234567891011" }, "t" : false }
     26 | { "$.a" : { "$numberDecimal" : "1234567891011" }, "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 3, "ikey" : { "a" : [true]}}', 'ikey', true, true, true, 35) term;
 length |                  term                  
---------------------------------------------------------------------
     21 | { "$" : { "a" : [  ] }, "t" : true }
     15 | { "$.a" : [  ], "t" : true }
     13 | { "$.a.0" : true, "t" : false }
     11 | { "$.a" : true, "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(6 rows)

SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms('{"_id": 1, "ikey" : { "a" : ["abcdefghijklmonpqrstuvwsyz"]}}', 'ikey', false, true, true, 50) term;
 length |                          term                           
---------------------------------------------------------------------
     46 | { "$" : { "a" : [ "abcdefghijklmonpq" ] }, "t" : true }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(3 rows)

SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "index_truncation_tests_nested_documents", "indexes": [ { "key": { "ikey": 1 }, "name": "ikey_1", "enableLargeIndexKeys": true } ] }');
NOTICE:  creating collection
                                                                                                   create_indexes_non_concurrently                                                                                                   
---------------------------------------------------------------------
 { "raw" : { "defaultShard" : { "numIndexesBefore" : { "$numberInt" : "1" }, "numIndexesAfter" : { "$numberInt" : "2" }, "createdCollectionAutomatically" : true, "ok" : { "$numberInt" : "1" } } }, "ok" : { "$numberInt" : "1" } }
(1 row)

-- now we have an index with truncation enabled and 100 chars.
\d helio_data.documents_10401;
                     Table "helio_data.documents_10401"
     Column      |           Type           | Collation | Nullable | Default 
---------------------------------------------------------------------
 shard_key_value | bigint                   |           | not null | 
 object_id       | helio_core.bson          |           | not null | 
 document        | helio_core.bson          |           | not null | 
 creation_time   | timestamp with time zone |           | not null | now()
Indexes:
    "collection_pk_10401" PRIMARY KEY, btree (shard_key_value, object_id)
    "documents_rum_index_10403" helio_rum (document bson_rum_single_path_ops (path=ikey, tl='50'))
Check constraints:
    "shard_key_value_check" CHECK (shard_key_value = '10401'::bigint)

-- now insert some documents that does exceed the index term limit.
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 1, "ikey": { "a" : ["abcdefghijklmonpqrstuvwsyz"]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 2, "ikey": { "a" : [1]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 3, "ikey": { "a" : [{ "$numberDecimal" : "1234567891011" }]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 4, "ikey": { "a" : [true]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 5, "ikey": { "a" : [[]}] }');
ERROR:  invalid input syntax JSON for BSON: Code: '1', Message 'Got parse error at "}", position 31: "BRACKET_MISMATCH"'
LINE 1: ...('db', 'index_truncation_tests_nested_documents', '{ "_id": ...
                                                             ^
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 6, "ikey": { "a" : [{}]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [1] } }';
                                             document                                              
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "a" : [ { "$numberDecimal" : "1234567891011" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
(4 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [false] } }';
                            document                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [[]] } }';
                            document                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
(1 row)

-- now insert some documents that does exceed the index term limit.
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 7, "ikey": { "a" : [["abcdefghijklmonpqrstuvwsyz"]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 8, "ikey": { "a" : [[1]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 9, "ikey": { "a" : [[{ "$numberDecimal" : "1234567891011" }]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 10, "ikey": { "a" : [[true]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 11, "ikey": { "a" : [[[]]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 12, "ikey": { "a" : [[{}]]} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [[1]] } }';
                                               document                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "a" : [ [ { "$numberDecimal" : "1234567891011" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
(6 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [[{ "$numberDecimal" : "1234567891011" }]] } }';
                                          document                                           
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
(5 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [[false]] } }';
                               document                               
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [[[]]] } }';
                               document                               
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
(2 rows)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 13, "ikey": "abcdefghijklmonpqrstuvwsyz" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 14, "ikey": 1 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 15, "ikey": { "$numberDecimal" : "1234567891011" } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 16, "ikey": true }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 17, "ikey": [] }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT helio_api.insert_one('db', 'index_truncation_tests_nested_documents', '{ "_id": 18, "ikey": {} }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": 1 } }';
                                             document                                              
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "a" : [ { "$numberDecimal" : "1234567891011" } ] } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": { "$numberDecimal" : "1234567891011" } } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": false } }';
                            document                             
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$gt": [] } }';
                                               document                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "a" : [ { "$numberDecimal" : "1234567891011" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "a" : [ [ { "$numberDecimal" : "1234567891011" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
(11 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$in": [1, true] } }';
                                     document                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$nin": [1, true] } }';
                                               document                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "a" : [ { "$numberDecimal" : "1234567891011" } ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "a" : [ [ { "$numberDecimal" : "1234567891011" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(15 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$elemMatch": { "$in": [1, true] } } }'; 
                                     document                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$elemMatch": { "$in": [[1], [true]] } } }'; 
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$elemMatch": { "$in": [1, "abcdefghijklmonpqrstuvwsyz"] } } }'; 
                                        document                                         
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$elemMatch": { "$in": [[1], ["abcdefghijklmonpqrstuvwsyz"]] } } }'; 
                                          document                                           
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$elemMatch": { "$in": [[1], [true]], "$gt": [{ "$numberDecimal" : "1234567891011" }] } } }'; 
                               document                               
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$all": [[1]] } }'; 
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
(2 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$all": [[[]]] } }'; 
                               document                               
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
(1 row)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$ne": { "$numberDecimal" : "1234567891011" } } }';
                                               document                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "a" : [ [ { "$numberDecimal" : "1234567891011" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(16 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$in": [[1], [true]] } }';
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
(4 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$nin": [[1], [true]] } }';
                                               document                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "a" : [ { "$numberDecimal" : "1234567891011" } ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "a" : [ [ { "$numberDecimal" : "1234567891011" } ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(13 rows)

SELECT document FROM helio_api.collection('db', 'index_truncation_tests_nested_documents') WHERE document @@ '{ "ikey.a": { "$ne": [{ "$numberDecimal" : "1234567891011" }] } }';
                                          document                                           
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "a" : [ "abcdefghijklmonpqrstuvwsyz" ] } }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "a" : [ { "$numberInt" : "1" } ] } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "a" : [ true ] } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "a" : [ {  } ] } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "a" : [ [ "abcdefghijklmonpqrstuvwsyz" ] ] } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "a" : [ [ { "$numberInt" : "1" } ] ] } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "a" : [ [ true ] ] } }
 { "_id" : { "$numberInt" : "11" }, "ikey" : { "a" : [ [ [  ] ] ] } }
 { "_id" : { "$numberInt" : "12" }, "ikey" : { "a" : [ [ {  } ] ] } }
 { "_id" : { "$numberInt" : "13" }, "ikey" : "abcdefghijklmonpqrstuvwsyz" }
 { "_id" : { "$numberInt" : "14" }, "ikey" : { "$numberInt" : "1" } }
 { "_id" : { "$numberInt" : "15" }, "ikey" : { "$numberDecimal" : "1234567891011" } }
 { "_id" : { "$numberInt" : "16" }, "ikey" : true }
 { "_id" : { "$numberInt" : "17" }, "ikey" : [  ] }
 { "_id" : { "$numberInt" : "18" }, "ikey" : {  } }
(15 rows)

-- specific tests
SET helio_api.enableIndexTermTruncationOnNestedObjects to off;
set helio_api.indexTermLimitOverride to 250;
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "index_truncation_tests_nested", "indexes": [ { "key": { "$**" : 1 }, "name": "wildcardIndex",  "enableLargeIndexKeys": true  } ] }', true);
NOTICE:  creating collection
                                                                                                   create_indexes_non_concurrently                                                                                                   
---------------------------------------------------------------------
 { "raw" : { "defaultShard" : { "numIndexesBefore" : { "$numberInt" : "1" }, "numIndexesAfter" : { "$numberInt" : "2" }, "createdCollectionAutomatically" : true, "ok" : { "$numberInt" : "1" } } }, "ok" : { "$numberInt" : "1" } }
(1 row)

SELECT helio_distributed_test_helpers.drop_primary_key('db', 'index_truncation_tests_nested');
 drop_primary_key 
---------------------------------------------------------------------
 
(1 row)

-- 1. Failes without nested object truncation support
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested', '
{
    "_id" : 1,
    "data": {
        "$binary": "AAAC2wEAAAJUY2RiOjQ6MTUwODEzOTY0OkNTOjA3MTQ4NjcwMDE2MjY2MTE5MTAwMDAxAgIwMjAxNi0wOS0xOVQwNjoxMDoyMy40MDBaAjAyMDE2LTA4LTI5VDE3OjA0OjIwLjAwMFoCEEI2NDM1SVNUAgQBAAAAAAAAAAAAAAAAAAAAAAACAgZFTVACGkVtcGxveWVlIE9ubHkCFDk5OTktMTItMzECAgAAAgICQQAAAgICAkECBkFTTwACDjA3MTQ4NjcAAAAAAAICBkUmSQAAAgIEMDECJFVuaXRlZGhlYWx0aCBHcm91cAI0Y2RiOkNTOjA3MTQ4Njc6MDAxMzowMDEzOkcAAAAAAgIEMDACTk5vdCBQYXJ0aWNpcGF0aW5nIEluIFNoYXJlZCBBcnJhbmdlbWVudAIOMDcxNDg2NwACFDA3MTQ4NjdHSVcAAAAAAAAAAgAAAhQyMDA5LTAxLTAxAAICBDAxAAAAAgRDUwIuMDcxNDg2NzAwMTYyNjYxMTkxMDAwMDEAAAAAAAAAAAACVGNkYjo0OjE1MDgxMzk2NDpDUzowNzE0ODY3MDAxNjI2NjExOTEwMDAwMQAAAAICMDIwMTYtMDktMTlUMDY6MTA6MjMuNDAwWgIwMjAxNi0wOC0yOVQxNzowNDoyMC4wMDBaAhBCNjQzNUlTVAACAgIAAAICBDUxAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAJEY2RiOmhlYWx0aDowNzE0ODY3OjIwMDktMDEtMDE6RzpJVwACAAIIMDAxMwIIMDAxMwACDjA3MTQ4NjcAAAAAAAIAAAACAAAAAAIAAAAAAAAAAAAAAAACAAAAAAAAAAACAgZjZGICAgICMAAAAgZDREIAAgAAAgICRwACAgJHAg5HRVRXRUxMAAIAAAAAAAIAAAIcSEVBTFRIX1NFUlZJQ0UAAAAAAAICBmNkYgICAgIwAAAAAAACAgISMDAwNzE0ODY3AgIOMDcxNDg2NwIESVcCAAIAAAICAjECAAACBElXAgJHAAAAAgZDREIAAAAAAAACFDIwMTAtMTItMzEAAQAAAAAAAAAAAAAAAAAAAAAAAgIGRVNQAiZFbXBsb3llZSBhbmQgU3BvdXNlAhQ5OTk5LTEyLTMxAgIAAAICAkEAAAICAgJBAgZBU08AAg4wNzE0ODY3AAAAAAACAgZFJkkAAAICBDAxAiRVbml0ZWRoZWFsdGggR3JvdXACNGNkYjpDUzowNzE0ODY3OjAwMTM6MDAxMzpHAAAAAAICBDAwAk5Ob3QgUGFydGljaXBhdGluZyBJbiBTaGFyZWQgQXJyYW5nZW1lbnQCDjA3MTQ4NjcAAhQwNzE0ODY3R0lXAAAAAAAAAAIAAAIUMjAxMS0wMS0wMQACAgQwMQAAAAIEQ1MCLjA3MTQ4NjcwMDE2MjY2MTE5MTAwMDAxAAAAAAAAAAAAAlRjZGI6NDoxNTA4MTM5NjQ6Q1M6MDcxNDg2NzAwMTYyNjYxMTkxMDAwMDEAAAACAjAyMDE2LTA5LTE5VDA2OjEwOjIzLjQwMFoCMDIwMTYtMDgtMjlUMTc6MDQ6MjAuMDAwWgIQQjY0MzVJU1QAAgICAAACAgQ1MQAAAAAAAAACAAAAAAAAAAAAAAAAAAACRGNkYjpoZWFsdGg6MDcxNDg2NzoyMDExLTAxLTAxOkc6SVcAAgACCDAwMTMCCDAwMTMAAg4wNzE0ODY3AAAAAAACAAAAAgAAAAACAAAAAAAAAAAAAAAAAgAAAAAAAAAAAgIGY2RiAgICAjAAAAIGQ0RCAAIAAAICAkcAAgICRwIOR0VUV0VMTAACAAAAAAACAAACHEhFQUxUSF9TRVJWSUNFAAAAAAACAgZjZGICAgICMAAAAAAAAgICEjAwMDcxNDg2NwICDjA3MTQ4NjcCBElXAgACAAACAgIzAgAAAgRJVwICRwAAAAIGQ0RCAAAAAAAAAhQyMDEzLTEyLTMxAAACAgZjZGICAgICMAAAAAIGQ0RC",
        "$type": "00"
    },
    "lastUpdated": {
        "sourceSystemTimestamp": "2016-09-19T06:10:23.400Z"
    },
    "kafkaPartition": 5,
    "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
    "kafkaTimestamp": {
        "$date": 1693431086173
    },
    "sourceIndividual": null,
    "active": false,
    "upsertTimestamp": {
        "$date": 1720803035593
    },
    "kafkaOffset": 21,
    "memberships": [
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        },
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2013-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2011-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2011-01-01"
        }
    ],
    "sourceSystemCode": "CDB",
    "rule": {
        "and": [
            {
                "or": [
                    {
                        "permission": "api-source-system-read-all"
                    },
                    {
                        "permission": "0"
                    }
                ]
            },
            {
                "securitySourceSystemCode": "cdb"
            }
        ]
    }
}');
                                                                                                                                     insert_one                                                                                                                                     
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "0" }, "ok" : { "$numberDouble" : "1.0" }, "writeErrors" : [ { "index" : { "$numberInt" : "0" }, "code" : { "$numberInt" : "29" }, "errmsg" : "Truncation size limit specified 250, but index term with type array was larger 1472 - isTruncated 0" } ] }
(1 row)

SET helio_api.enableIndexTermTruncationOnNestedObjects to on;
-- 2 a. Terms generated with nested object index term truncation support
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms(
  '{
    "_id": 1, 
    "memberships" : [
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        },
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2013-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2011-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2011-01-01"
        }
    ]
  }'
, 'memberships', true, true, true, 1000) term;
 length |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               term                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
---------------------------------------------------------------------
    998 | { "$" : [ { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2010-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2009-01-" } ], "t" : true }
    997 | { "$.0" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2010-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:" }, "t" : true }
    115 | { "$.0.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "t" : false }
    109 | { "$.0.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } }, "t" : false }
     74 | { "$.0.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     68 | { "$.0.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     65 | { "$.0.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     59 | { "$.0.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.0.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     52 | { "$.0.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     55 | { "$.0.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     78 | { "$.0.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     30 | { "$.0.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     53 | { "$.0.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     47 | { "$.0.legacyAttributes.stateIssueCode" : "", "t" : false }
     50 | { "$.0.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     44 | { "$.0.eligibilitySystemType.code" : "01", "t" : false }
     55 | { "$.0.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     36 | { "$.0.coverageStatus.code" : "A", "t" : false }
     37 | { "$.0.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.0.terminationDate" : "2010-12-31", "t" : false }
     41 | { "$.0.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     22 | { "$.0.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.0.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.0.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.0.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.0.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     43 | { "$.0.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.0.customerAccountIdentifier" : "0714867", "t" : false }
     20 | { "$.0.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     36 | { "$.0.enrolleeSourceCode" : "CS", "t" : false }
     35 | { "$.0.plan" : { "planCode" : "" }, "t" : false }
     29 | { "$.0.plan.planCode" : "", "t" : false }
     20 | { "$.0.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.0.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     60 | { "$.0.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     54 | { "$.0.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     48 | { "$.0.product.healthCoverageType.code" : "G", "t" : false }
     18 | { "$.0.active" : true, "t" : false }
     32 | { "$.0.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     28 | { "$.0.divisionCode" : "", "t" : false }
     15 | { "$.0.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.0.productCode" : "", "t" : false }
     70 | { "$.0.membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "t" : false }
     80 | { "$.0.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     50 | { "$.0.organization.planVariationCode" : "0013", "t" : false }
     46 | { "$.0.organization.reportingCode" : "0013", "t" : false }
     22 | { "$.0.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
    304 | { "$.0.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "t" : false }
     60 | { "$.0.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     54 | { "$.0.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     43 | { "$.0.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     80 | { "$.0.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     63 | { "$.0.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     57 | { "$.0.customerAccount.businessArrangement.code" : "A", "t" : false }
     64 | { "$.0.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     62 | { "$.0.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     56 | { "$.0.customerAccount.sharedArrangement.code" : "00", "t" : false }
     52 | { "$.0.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     46 | { "$.0.customerAccount.obligor.code" : "01", "t" : false }
     49 | { "$.0.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     29 | { "$.0.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.0.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.0.effectiveDate" : "2009-01-01", "t" : false }
    997 | { "$.1" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2013-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:" }, "t" : true }
    115 | { "$.1.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "t" : false }
    109 | { "$.1.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } }, "t" : false }
     74 | { "$.1.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     68 | { "$.1.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     65 | { "$.1.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     59 | { "$.1.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.1.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     52 | { "$.1.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     55 | { "$.1.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     78 | { "$.1.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     30 | { "$.1.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     53 | { "$.1.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     47 | { "$.1.legacyAttributes.stateIssueCode" : "", "t" : false }
     50 | { "$.1.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     44 | { "$.1.eligibilitySystemType.code" : "01", "t" : false }
     55 | { "$.1.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     36 | { "$.1.coverageStatus.code" : "A", "t" : false }
     37 | { "$.1.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.1.terminationDate" : "2013-12-31", "t" : false }
     41 | { "$.1.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     22 | { "$.1.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.1.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.1.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.1.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.1.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     43 | { "$.1.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.1.customerAccountIdentifier" : "0714867", "t" : false }
     20 | { "$.1.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     36 | { "$.1.enrolleeSourceCode" : "CS", "t" : false }
     35 | { "$.1.plan" : { "planCode" : "" }, "t" : false }
     29 | { "$.1.plan.planCode" : "", "t" : false }
     20 | { "$.1.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.1.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     60 | { "$.1.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     54 | { "$.1.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     48 | { "$.1.product.healthCoverageType.code" : "G", "t" : false }
     18 | { "$.1.active" : true, "t" : false }
     32 | { "$.1.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     28 | { "$.1.divisionCode" : "", "t" : false }
     15 | { "$.1.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.1.productCode" : "", "t" : false }
     70 | { "$.1.membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:IW", "t" : false }
     80 | { "$.1.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     50 | { "$.1.organization.planVariationCode" : "0013", "t" : false }
     46 | { "$.1.organization.reportingCode" : "0013", "t" : false }
     22 | { "$.1.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
    304 | { "$.1.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "t" : false }
     60 | { "$.1.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     54 | { "$.1.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     43 | { "$.1.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     80 | { "$.1.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     63 | { "$.1.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     57 | { "$.1.customerAccount.businessArrangement.code" : "A", "t" : false }
     64 | { "$.1.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     62 | { "$.1.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     56 | { "$.1.customerAccount.sharedArrangement.code" : "00", "t" : false }
     52 | { "$.1.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     46 | { "$.1.customerAccount.obligor.code" : "01", "t" : false }
     49 | { "$.1.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     29 | { "$.1.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.1.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.1.effectiveDate" : "2011-01-01", "t" : false }
    997 | { "$" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2010-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW" }, "t" : true }
    113 | { "$.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "t" : false }
    107 | { "$.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } }, "t" : false }
     72 | { "$.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     66 | { "$.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     63 | { "$.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     57 | { "$.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     53 | { "$.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     76 | { "$.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     28 | { "$.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     51 | { "$.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     45 | { "$.legacyAttributes.stateIssueCode" : "", "t" : false }
     48 | { "$.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     42 | { "$.eligibilitySystemType.code" : "01", "t" : false }
     53 | { "$.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     34 | { "$.coverageStatus.code" : "A", "t" : false }
     35 | { "$.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.terminationDate" : "2010-12-31", "t" : false }
     39 | { "$.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     20 | { "$.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     24 | { "$.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     46 | { "$.customerAccountIdentifier" : "0714867", "t" : false }
     18 | { "$.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     34 | { "$.enrolleeSourceCode" : "CS", "t" : false }
     33 | { "$.plan" : { "planCode" : "" }, "t" : false }
     27 | { "$.plan.planCode" : "", "t" : false }
     18 | { "$.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     58 | { "$.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     52 | { "$.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     46 | { "$.product.healthCoverageType.code" : "G", "t" : false }
     16 | { "$.active" : true, "t" : false }
     30 | { "$.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.divisionCode" : "", "t" : false }
     13 | { "$.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.productCode" : "", "t" : false }
     68 | { "$.membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "t" : false }
     78 | { "$.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     48 | { "$.organization.planVariationCode" : "0013", "t" : false }
     44 | { "$.organization.reportingCode" : "0013", "t" : false }
     20 | { "$.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
    302 | { "$.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "t" : false }
     58 | { "$.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     52 | { "$.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     41 | { "$.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     78 | { "$.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     61 | { "$.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     55 | { "$.customerAccount.businessArrangement.code" : "A", "t" : false }
     62 | { "$.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     60 | { "$.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     54 | { "$.customerAccount.sharedArrangement.code" : "00", "t" : false }
     50 | { "$.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     44 | { "$.customerAccount.obligor.code" : "01", "t" : false }
     47 | { "$.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     35 | { "$.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.effectiveDate" : "2009-01-01", "t" : false }
    997 | { "$" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2013-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:IW" }, "t" : true }
    113 | { "$.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "t" : false }
    107 | { "$.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } }, "t" : false }
     72 | { "$.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     66 | { "$.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     63 | { "$.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     57 | { "$.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     53 | { "$.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     76 | { "$.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     28 | { "$.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     51 | { "$.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     45 | { "$.legacyAttributes.stateIssueCode" : "", "t" : false }
     48 | { "$.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     42 | { "$.eligibilitySystemType.code" : "01", "t" : false }
     53 | { "$.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     34 | { "$.coverageStatus.code" : "A", "t" : false }
     35 | { "$.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.terminationDate" : "2013-12-31", "t" : false }
     39 | { "$.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     20 | { "$.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     24 | { "$.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     46 | { "$.customerAccountIdentifier" : "0714867", "t" : false }
     18 | { "$.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     34 | { "$.enrolleeSourceCode" : "CS", "t" : false }
     33 | { "$.plan" : { "planCode" : "" }, "t" : false }
     27 | { "$.plan.planCode" : "", "t" : false }
     18 | { "$.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     58 | { "$.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     52 | { "$.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     46 | { "$.product.healthCoverageType.code" : "G", "t" : false }
     16 | { "$.active" : true, "t" : false }
     30 | { "$.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.divisionCode" : "", "t" : false }
     13 | { "$.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.productCode" : "", "t" : false }
     68 | { "$.membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:IW", "t" : false }
     78 | { "$.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     48 | { "$.organization.planVariationCode" : "0013", "t" : false }
     44 | { "$.organization.reportingCode" : "0013", "t" : false }
     20 | { "$.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
    302 | { "$.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "t" : false }
     58 | { "$.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     52 | { "$.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     41 | { "$.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     78 | { "$.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     61 | { "$.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     55 | { "$.customerAccount.businessArrangement.code" : "A", "t" : false }
     62 | { "$.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     60 | { "$.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     54 | { "$.customerAccount.sharedArrangement.code" : "00", "t" : false }
     50 | { "$.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     44 | { "$.customerAccount.obligor.code" : "01", "t" : false }
     47 | { "$.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     35 | { "$.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.effectiveDate" : "2011-01-01", "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(344 rows)

-- 2 b. Terms generated with nested object index term truncation support
SELECT length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM helio_distributed_test_helpers.gin_bson_get_single_path_generated_terms(
  '{
    "_id": 1, 
    "memberships" : [
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        },
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2013-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2011-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2011-01-01"
        }
    ]
  }'
, 'memberships', true, true, true, 100) term;
 length |                                                                       term                                                                       
---------------------------------------------------------------------
     98 | { "$" : [ { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } } } ], "t" : true }
     92 | { "$.0" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } } }, "t" : true }
     86 | { "$.0.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } }, "t" : true }
     87 | { "$.0.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "$maxKey" : 1 } }, "t" : true }
     74 | { "$.0.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     68 | { "$.0.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     65 | { "$.0.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     59 | { "$.0.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.0.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     52 | { "$.0.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     55 | { "$.0.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     78 | { "$.0.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     30 | { "$.0.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     53 | { "$.0.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     47 | { "$.0.legacyAttributes.stateIssueCode" : "", "t" : false }
     50 | { "$.0.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     44 | { "$.0.eligibilitySystemType.code" : "01", "t" : false }
     55 | { "$.0.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     36 | { "$.0.coverageStatus.code" : "A", "t" : false }
     37 | { "$.0.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.0.terminationDate" : "2010-12-31", "t" : false }
     41 | { "$.0.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     22 | { "$.0.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.0.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.0.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.0.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.0.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     43 | { "$.0.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.0.customerAccountIdentifier" : "0714867", "t" : false }
     20 | { "$.0.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     36 | { "$.0.enrolleeSourceCode" : "CS", "t" : false }
     35 | { "$.0.plan" : { "planCode" : "" }, "t" : false }
     29 | { "$.0.plan.planCode" : "", "t" : false }
     20 | { "$.0.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.0.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     60 | { "$.0.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     54 | { "$.0.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     48 | { "$.0.product.healthCoverageType.code" : "G", "t" : false }
     18 | { "$.0.active" : true, "t" : false }
     32 | { "$.0.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     28 | { "$.0.divisionCode" : "", "t" : false }
     15 | { "$.0.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.0.productCode" : "", "t" : false }
     70 | { "$.0.membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "t" : false }
     80 | { "$.0.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     50 | { "$.0.organization.planVariationCode" : "0013", "t" : false }
     46 | { "$.0.organization.reportingCode" : "0013", "t" : false }
     22 | { "$.0.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     84 | { "$.0.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : { "$maxKey" : 1 } }, "t" : true }
     60 | { "$.0.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     54 | { "$.0.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     43 | { "$.0.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     80 | { "$.0.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     63 | { "$.0.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     57 | { "$.0.customerAccount.businessArrangement.code" : "A", "t" : false }
     64 | { "$.0.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     62 | { "$.0.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     56 | { "$.0.customerAccount.sharedArrangement.code" : "00", "t" : false }
     52 | { "$.0.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     46 | { "$.0.customerAccount.obligor.code" : "01", "t" : false }
     49 | { "$.0.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     29 | { "$.0.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.0.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.0.effectiveDate" : "2009-01-01", "t" : false }
     92 | { "$.1" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } } }, "t" : true }
     86 | { "$.1.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } }, "t" : true }
     87 | { "$.1.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "$maxKey" : 1 } }, "t" : true }
     74 | { "$.1.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     68 | { "$.1.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     65 | { "$.1.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     59 | { "$.1.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.1.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     52 | { "$.1.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     55 | { "$.1.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     78 | { "$.1.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     30 | { "$.1.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     53 | { "$.1.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     47 | { "$.1.legacyAttributes.stateIssueCode" : "", "t" : false }
     50 | { "$.1.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     44 | { "$.1.eligibilitySystemType.code" : "01", "t" : false }
     55 | { "$.1.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     36 | { "$.1.coverageStatus.code" : "A", "t" : false }
     37 | { "$.1.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.1.terminationDate" : "2013-12-31", "t" : false }
     41 | { "$.1.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     22 | { "$.1.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.1.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.1.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.1.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.1.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     43 | { "$.1.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.1.customerAccountIdentifier" : "0714867", "t" : false }
     20 | { "$.1.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     36 | { "$.1.enrolleeSourceCode" : "CS", "t" : false }
     35 | { "$.1.plan" : { "planCode" : "" }, "t" : false }
     29 | { "$.1.plan.planCode" : "", "t" : false }
     20 | { "$.1.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     33 | { "$.1.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     60 | { "$.1.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     54 | { "$.1.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     48 | { "$.1.product.healthCoverageType.code" : "G", "t" : false }
     18 | { "$.1.active" : true, "t" : false }
     32 | { "$.1.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     28 | { "$.1.divisionCode" : "", "t" : false }
     15 | { "$.1.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.1.productCode" : "", "t" : false }
     70 | { "$.1.membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:IW", "t" : false }
     80 | { "$.1.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     50 | { "$.1.organization.planVariationCode" : "0013", "t" : false }
     46 | { "$.1.organization.reportingCode" : "0013", "t" : false }
     22 | { "$.1.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     84 | { "$.1.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : { "$maxKey" : 1 } }, "t" : true }
     60 | { "$.1.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     54 | { "$.1.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     43 | { "$.1.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     80 | { "$.1.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     63 | { "$.1.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     57 | { "$.1.customerAccount.businessArrangement.code" : "A", "t" : false }
     64 | { "$.1.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     62 | { "$.1.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     56 | { "$.1.customerAccount.sharedArrangement.code" : "00", "t" : false }
     52 | { "$.1.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     46 | { "$.1.customerAccount.obligor.code" : "01", "t" : false }
     49 | { "$.1.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     29 | { "$.1.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.1.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.1.effectiveDate" : "2011-01-01", "t" : false }
     90 | { "$" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } } }, "t" : true }
     84 | { "$.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } }, "t" : true }
     85 | { "$.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "$maxKey" : 1 } }, "t" : true }
     72 | { "$.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     66 | { "$.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     63 | { "$.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     57 | { "$.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     53 | { "$.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     76 | { "$.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     28 | { "$.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     51 | { "$.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     45 | { "$.legacyAttributes.stateIssueCode" : "", "t" : false }
     48 | { "$.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     42 | { "$.eligibilitySystemType.code" : "01", "t" : false }
     53 | { "$.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     34 | { "$.coverageStatus.code" : "A", "t" : false }
     35 | { "$.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.terminationDate" : "2010-12-31", "t" : false }
     39 | { "$.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     20 | { "$.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     24 | { "$.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     46 | { "$.customerAccountIdentifier" : "0714867", "t" : false }
     18 | { "$.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     34 | { "$.enrolleeSourceCode" : "CS", "t" : false }
     33 | { "$.plan" : { "planCode" : "" }, "t" : false }
     27 | { "$.plan.planCode" : "", "t" : false }
     18 | { "$.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     58 | { "$.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     52 | { "$.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     46 | { "$.product.healthCoverageType.code" : "G", "t" : false }
     16 | { "$.active" : true, "t" : false }
     30 | { "$.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.divisionCode" : "", "t" : false }
     13 | { "$.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.productCode" : "", "t" : false }
     68 | { "$.membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "t" : false }
     78 | { "$.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     48 | { "$.organization.planVariationCode" : "0013", "t" : false }
     44 | { "$.organization.reportingCode" : "0013", "t" : false }
     20 | { "$.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     98 | { "$.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageId" : { "$maxKey" : 1 } }, "t" : true }
     58 | { "$.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     52 | { "$.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     41 | { "$.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     78 | { "$.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     61 | { "$.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     55 | { "$.customerAccount.businessArrangement.code" : "A", "t" : false }
     62 | { "$.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     60 | { "$.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     54 | { "$.customerAccount.sharedArrangement.code" : "00", "t" : false }
     50 | { "$.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     44 | { "$.customerAccount.obligor.code" : "01", "t" : false }
     47 | { "$.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     35 | { "$.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.effectiveDate" : "2009-01-01", "t" : false }
     90 | { "$" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } } }, "t" : true }
     84 | { "$.sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : { "$maxKey" : 1 } } } }, "t" : true }
     85 | { "$.sourceSystemAttributes.cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "$maxKey" : 1 } }, "t" : true }
     72 | { "$.sourceSystemAttributes.cdb.referenceData" : { "coverageTypeCode" : null }, "t" : false }
     66 | { "$.sourceSystemAttributes.cdb.referenceData.coverageTypeCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     63 | { "$.sourceSystemAttributes.cdb.nonCs" : { "legalEntityName" : null }, "t" : false }
     57 | { "$.sourceSystemAttributes.cdb.nonCs.legalEntityName" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.cancelReasonType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     50 | { "$.customerPurchaseIdentifier" : "0714867GIW", "t" : false }
     53 | { "$.enrolleeSourceId" : "07148670016266119100001", "t" : false }
     76 | { "$.individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "t" : false }
     28 | { "$.membershipGroupData" : null, "t" : false }
      7 | { "" : null, "t" : false }
     51 | { "$.legacyAttributes" : { "stateIssueCode" : "" }, "t" : false }
     45 | { "$.legacyAttributes.stateIssueCode" : "", "t" : false }
     48 | { "$.eligibilitySystemType" : { "code" : "01" }, "t" : false }
     42 | { "$.eligibilitySystemType.code" : "01", "t" : false }
     53 | { "$.coverageStatus" : { "code" : "A", "description" : null }, "t" : false }
     34 | { "$.coverageStatus.code" : "A", "t" : false }
     35 | { "$.coverageStatus.description" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.terminationDate" : "2013-12-31", "t" : false }
     39 | { "$.subscriberIndividualIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     20 | { "$.panelNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     39 | { "$.enrolleeMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     24 | { "$.claimSystemType" : null, "t" : false }
      7 | { "" : null, "t" : false }
     48 | { "$.medicareAndRetirementMembershipProfiles" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.organizationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     41 | { "$.subscriberMemberFacingIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     46 | { "$.customerAccountIdentifier" : "0714867", "t" : false }
     18 | { "$.segmentId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     34 | { "$.enrolleeSourceCode" : "CS", "t" : false }
     33 | { "$.plan" : { "planCode" : "" }, "t" : false }
     27 | { "$.plan.planCode" : "", "t" : false }
     18 | { "$.areaGroup" : null, "t" : false }
      7 | { "" : null, "t" : false }
     31 | { "$.packageBenefitPlanCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     58 | { "$.product" : { "healthCoverageType" : { "code" : "G" } }, "t" : false }
     52 | { "$.product.healthCoverageType" : { "code" : "G" }, "t" : false }
     46 | { "$.product.healthCoverageType.code" : "G", "t" : false }
     16 | { "$.active" : true, "t" : false }
     30 | { "$.applicationIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     26 | { "$.divisionCode" : "", "t" : false }
     13 | { "$.site" : null, "t" : false }
      7 | { "" : null, "t" : false }
     25 | { "$.productCode" : "", "t" : false }
     68 | { "$.membershipIdentifier" : "cdb:health:0714867:2011-01-01:G:IW", "t" : false }
     78 | { "$.organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "t" : false }
     48 | { "$.organization.planVariationCode" : "0013", "t" : false }
     44 | { "$.organization.reportingCode" : "0013", "t" : false }
     20 | { "$.hContractId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     98 | { "$.customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageId" : { "$maxKey" : 1 } }, "t" : true }
     58 | { "$.customerAccount.lineOfBusiness" : { "code" : "E&I" }, "t" : false }
     52 | { "$.customerAccount.lineOfBusiness.code" : "E&I", "t" : false }
     41 | { "$.customerAccount.policySuffixCode" : null, "t" : false }
      7 | { "" : null, "t" : false }
     78 | { "$.customerAccount.planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "t" : false }
     61 | { "$.customerAccount.businessArrangement" : { "code" : "A" }, "t" : false }
     55 | { "$.customerAccount.businessArrangement.code" : "A", "t" : false }
     62 | { "$.customerAccount.customerAccountIdentifier" : "0714867", "t" : false }
     60 | { "$.customerAccount.sharedArrangement" : { "code" : "00" }, "t" : false }
     54 | { "$.customerAccount.sharedArrangement.code" : "00", "t" : false }
     50 | { "$.customerAccount.obligor" : { "code" : "01" }, "t" : false }
     44 | { "$.customerAccount.obligor.code" : "01", "t" : false }
     47 | { "$.customerAccount.purchasePlanIdentifier" : null, "t" : false }
      7 | { "" : null, "t" : false }
     27 | { "$.memberMarketNumber" : null, "t" : false }
      7 | { "" : null, "t" : false }
     35 | { "$.subscriberEnrolleeSourceId" : null, "t" : false }
      7 | { "" : null, "t" : false }
     37 | { "$.effectiveDate" : "2011-01-01", "t" : false }
      8 | { "" : true, "t" : false }
      7 | { "" : { "$maxKey" : 1 }, "t" : true }
     12 | { "" : [  ], "t" : false }
(344 rows)

-- 3. Now insert the document with nested object index term truncation support
SELECT helio_api.insert_one('db', 'index_truncation_tests_nested', '
{
    "_id": 1, 
    "data": {
        "$binary": "AAAC2wEAAAJUY2RiOjQ6MTUwODEzOTY0OkNTOjA3MTQ4NjcwMDE2MjY2MTE5MTAwMDAxAgIwMjAxNi0wOS0xOVQwNjoxMDoyMy40MDBaAjAyMDE2LTA4LTI5VDE3OjA0OjIwLjAwMFoCEEI2NDM1SVNUAgQBAAAAAAAAAAAAAAAAAAAAAAACAgZFTVACGkVtcGxveWVlIE9ubHkCFDk5OTktMTItMzECAgAAAgICQQAAAgICAkECBkFTTwACDjA3MTQ4NjcAAAAAAAICBkUmSQAAAgIEMDECJFVuaXRlZGhlYWx0aCBHcm91cAI0Y2RiOkNTOjA3MTQ4Njc6MDAxMzowMDEzOkcAAAAAAgIEMDACTk5vdCBQYXJ0aWNpcGF0aW5nIEluIFNoYXJlZCBBcnJhbmdlbWVudAIOMDcxNDg2NwACFDA3MTQ4NjdHSVcAAAAAAAAAAgAAAhQyMDA5LTAxLTAxAAICBDAxAAAAAgRDUwIuMDcxNDg2NzAwMTYyNjYxMTkxMDAwMDEAAAAAAAAAAAACVGNkYjo0OjE1MDgxMzk2NDpDUzowNzE0ODY3MDAxNjI2NjExOTEwMDAwMQAAAAICMDIwMTYtMDktMTlUMDY6MTA6MjMuNDAwWgIwMjAxNi0wOC0yOVQxNzowNDoyMC4wMDBaAhBCNjQzNUlTVAACAgIAAAICBDUxAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAJEY2RiOmhlYWx0aDowNzE0ODY3OjIwMDktMDEtMDE6RzpJVwACAAIIMDAxMwIIMDAxMwACDjA3MTQ4NjcAAAAAAAIAAAACAAAAAAIAAAAAAAAAAAAAAAACAAAAAAAAAAACAgZjZGICAgICMAAAAgZDREIAAgAAAgICRwACAgJHAg5HRVRXRUxMAAIAAAAAAAIAAAIcSEVBTFRIX1NFUlZJQ0UAAAAAAAICBmNkYgICAgIwAAAAAAACAgISMDAwNzE0ODY3AgIOMDcxNDg2NwIESVcCAAIAAAICAjECAAACBElXAgJHAAAAAgZDREIAAAAAAAACFDIwMTAtMTItMzEAAQAAAAAAAAAAAAAAAAAAAAAAAgIGRVNQAiZFbXBsb3llZSBhbmQgU3BvdXNlAhQ5OTk5LTEyLTMxAgIAAAICAkEAAAICAgJBAgZBU08AAg4wNzE0ODY3AAAAAAACAgZFJkkAAAICBDAxAiRVbml0ZWRoZWFsdGggR3JvdXACNGNkYjpDUzowNzE0ODY3OjAwMTM6MDAxMzpHAAAAAAICBDAwAk5Ob3QgUGFydGljaXBhdGluZyBJbiBTaGFyZWQgQXJyYW5nZW1lbnQCDjA3MTQ4NjcAAhQwNzE0ODY3R0lXAAAAAAAAAAIAAAIUMjAxMS0wMS0wMQACAgQwMQAAAAIEQ1MCLjA3MTQ4NjcwMDE2MjY2MTE5MTAwMDAxAAAAAAAAAAAAAlRjZGI6NDoxNTA4MTM5NjQ6Q1M6MDcxNDg2NzAwMTYyNjYxMTkxMDAwMDEAAAACAjAyMDE2LTA5LTE5VDA2OjEwOjIzLjQwMFoCMDIwMTYtMDgtMjlUMTc6MDQ6MjAuMDAwWgIQQjY0MzVJU1QAAgICAAACAgQ1MQAAAAAAAAACAAAAAAAAAAAAAAAAAAACRGNkYjpoZWFsdGg6MDcxNDg2NzoyMDExLTAxLTAxOkc6SVcAAgACCDAwMTMCCDAwMTMAAg4wNzE0ODY3AAAAAAACAAAAAgAAAAACAAAAAAAAAAAAAAAAAgAAAAAAAAAAAgIGY2RiAgICAjAAAAIGQ0RCAAIAAAICAkcAAgICRwIOR0VUV0VMTAACAAAAAAACAAACHEhFQUxUSF9TRVJWSUNFAAAAAAACAgZjZGICAgICMAAAAAAAAgICEjAwMDcxNDg2NwICDjA3MTQ4NjcCBElXAgACAAACAgIzAgAAAgRJVwICRwAAAAIGQ0RCAAAAAAAAAhQyMDEzLTEyLTMxAAACAgZjZGICAgICMAAAAAIGQ0RC",
        "$type": "00"
    },
    "lastUpdated": {
        "sourceSystemTimestamp": "2016-09-19T06:10:23.400Z"
    },
    "kafkaPartition": 5,
    "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
    "kafkaTimestamp": {
        "$date": 1693431086173
    },
    "sourceIndividual": null,
    "active": false,
    "upsertTimestamp": {
        "$date": 1720803035593
    },
    "kafkaOffset": 21,
    "memberships": [
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        },
        {
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2013-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2011-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2011-01-01"
        }
    ],
    "sourceSystemCode": "CDB",
    "rule": {
        "and": [
            {
                "or": [
                    {
                        "permission": "api-source-system-read-all"
                    },
                    {
                        "permission": "0"
                    }
                ]
            },
            {
                "securitySourceSystemCode": "cdb"
            }
        ]
    }
}');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

-- 4. Now issue a find query
SELECT document FROM bson_aggregation_find('db', '{ "find": "index_truncation_tests_nested", "filter": { "memberships": { "$eq": 

{
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        } 

} }, "projection": { "_id": 1 }, "sort": { "_id": 1 }, "skip": 0, "limit": 5 }');
              document              
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" } }
(1 row)

-- 5. Index usage explain
EXPLAIN(ANALYZE ON, COSTS OFF, TIMING OFF, SUMMARY OFF, BUFFERS OFF) SELECT document FROM bson_aggregation_find('db', '{ "find": "index_truncation_tests_nested", "filter": { "memberships": { "$eq": 

{
            "sourceSystemAttributes": {
                "cdb": {
                    "referenceData": {
                        "coverageTypeCode": null
                    },
                    "nonCs": {
                        "legalEntityName": null
                    }
                }
            },
            "cancelReasonType": null,
            "customerPurchaseIdentifier": "0714867GIW",
            "enrolleeSourceId": "07148670016266119100001",
            "individualIdentifier": "cdb:4:150813964:CS:07148670016266119100001",
            "membershipGroupData": null,
            "legacyAttributes": {
                "stateIssueCode": ""
            },
            "eligibilitySystemType": {
                "code": "01"
            },
            "coverageStatus": {
                "code": "A",
                "description": null
            },
            "terminationDate": "2010-12-31",
            "subscriberIndividualIdentifier": null,
            "panelNumber": null,
            "enrolleeMemberFacingIdentifier": null,
            "claimSystemType": null,
            "medicareAndRetirementMembershipProfiles": null,
            "organizationIdentifier": null,
            "subscriberMemberFacingIdentifier": null,
            "customerAccountIdentifier": "0714867",
            "segmentId": null,
            "enrolleeSourceCode": "CS",
            "plan": {
                "planCode": ""
            },
            "areaGroup": null,
            "packageBenefitPlanCode": null,
            "product": {
                "healthCoverageType": {
                    "code": "G"
                }
            },
            "active": true,
            "applicationIdentifier": null,
            "divisionCode": "",
            "site": null,
            "productCode": "",
            "membershipIdentifier": "cdb:health:0714867:2009-01-01:G:IW",
            "organization": {
                "planVariationCode": "0013",
                "reportingCode": "0013"
            },
            "hContractId": null,
            "customerAccount": {
                "lineOfBusiness": {
                    "code": "E&I"
                },
                "policySuffixCode": null,
                "planCoverageIdentifier": "cdb:CS:0714867:0013:0013:G",
                "businessArrangement": {
                    "code": "A"
                },
                "customerAccountIdentifier": "0714867",
                "sharedArrangement": {
                    "code": "00"
                },
                "obligor": {
                    "code": "01"
                },
                "purchasePlanIdentifier": null
            },
            "memberMarketNumber": null,
            "subscriberEnrolleeSourceId": null,
            "effectiveDate": "2009-01-01"
        } 

} }, "projection": { "_id": 1 }, "sort": { "_id": 1 }, "skip": 0, "limit": 5 }');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive) (actual rows=1 loops=1)
   Task Count: 1
   Tuple data received from nodes: 14 bytes
   Tasks Shown: All
   ->  Task
         Tuple data received from node: 14 bytes
         Node: host=localhost port=58070 dbname=regression
         ->  Limit (actual rows=1 loops=1)
               ->  Sort (actual rows=1 loops=1)
                     Sort Key: object_id
                     Sort Method: quicksort  Memory: 25kB
                     ->  Bitmap Heap Scan on documents_10402_1040038 collection (actual rows=1 loops=1)
                           Recheck Cond: (document OPERATOR(helio_api_catalog.@=) '{ "memberships" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2010-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "hContractId" : null, "customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "memberMarketNumber" : null, "subscriberEnrolleeSourceId" : null, "effectiveDate" : "2009-01-01" } }'::helio_core.bson)
                           Heap Blocks: exact=1
                           ->  Bitmap Index Scan on "wildcardIndex" (actual rows=1 loops=1)
                                 Index Cond: (document OPERATOR(helio_api_catalog.@=) '{ "memberships" : { "sourceSystemAttributes" : { "cdb" : { "referenceData" : { "coverageTypeCode" : null }, "nonCs" : { "legalEntityName" : null } } }, "cancelReasonType" : null, "customerPurchaseIdentifier" : "0714867GIW", "enrolleeSourceId" : "07148670016266119100001", "individualIdentifier" : "cdb:4:150813964:CS:07148670016266119100001", "membershipGroupData" : null, "legacyAttributes" : { "stateIssueCode" : "" }, "eligibilitySystemType" : { "code" : "01" }, "coverageStatus" : { "code" : "A", "description" : null }, "terminationDate" : "2010-12-31", "subscriberIndividualIdentifier" : null, "panelNumber" : null, "enrolleeMemberFacingIdentifier" : null, "claimSystemType" : null, "medicareAndRetirementMembershipProfiles" : null, "organizationIdentifier" : null, "subscriberMemberFacingIdentifier" : null, "customerAccountIdentifier" : "0714867", "segmentId" : null, "enrolleeSourceCode" : "CS", "plan" : { "planCode" : "" }, "areaGroup" : null, "packageBenefitPlanCode" : null, "product" : { "healthCoverageType" : { "code" : "G" } }, "active" : true, "applicationIdentifier" : null, "divisionCode" : "", "site" : null, "productCode" : "", "membershipIdentifier" : "cdb:health:0714867:2009-01-01:G:IW", "organization" : { "planVariationCode" : "0013", "reportingCode" : "0013" }, "hContractId" : null, "customerAccount" : { "lineOfBusiness" : { "code" : "E&I" }, "policySuffixCode" : null, "planCoverageIdentifier" : "cdb:CS:0714867:0013:0013:G", "businessArrangement" : { "code" : "A" }, "customerAccountIdentifier" : "0714867", "sharedArrangement" : { "code" : "00" }, "obligor" : { "code" : "01" }, "purchasePlanIdentifier" : null }, "memberMarketNumber" : null, "subscriberEnrolleeSourceId" : null, "effectiveDate" : "2009-01-01" } }'::helio_core.bson)
(16 rows)

SELECT document FROM bson_aggregation_find('db', '{ "find": "index_truncation_tests_nested", "filter": { "memberships.organization.planVariationCode": { "$eq": 

"0013"

} }, "projection": { "_id": 1 }, "sort": { "_id": 1 }, "skip": 0, "limit": 5 }');
              document              
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" } }
(1 row)

EXPLAIN(ANALYZE ON, COSTS OFF, TIMING OFF, SUMMARY OFF, BUFFERS OFF) SELECT document FROM bson_aggregation_find('db', '{ "find": "index_truncation_tests_nested", "filter": { "memberships.organization.planVariationCode": { "$eq": 

"0013"

} }, "projection": { "_id": 1 }, "sort": { "_id": 1 }, "skip": 0, "limit": 5 }');
                                                                             QUERY PLAN                                                                             
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive) (actual rows=1 loops=1)
   Task Count: 1
   Tuple data received from nodes: 14 bytes
   Tasks Shown: All
   ->  Task
         Tuple data received from node: 14 bytes
         Node: host=localhost port=58070 dbname=regression
         ->  Limit (actual rows=1 loops=1)
               ->  Sort (actual rows=1 loops=1)
                     Sort Key: object_id
                     Sort Method: quicksort  Memory: 25kB
                     ->  Bitmap Heap Scan on documents_10402_1040038 collection (actual rows=1 loops=1)
                           Recheck Cond: (document OPERATOR(helio_api_catalog.@=) '{ "memberships.organization.planVariationCode" : "0013" }'::helio_core.bson)
                           Heap Blocks: exact=1
                           ->  Bitmap Index Scan on "wildcardIndex" (actual rows=1 loops=1)
                                 Index Cond: (document OPERATOR(helio_api_catalog.@=) '{ "memberships.organization.planVariationCode" : "0013" }'::helio_core.bson)
(16 rows)

SET helio_api.enableIndexTermTruncationOnNestedObjects to off;
