SET search_path TO helio_api,helio_core,helio_api_catalog;
SET helio_api.next_collection_id TO 3500;
SET helio_api.next_collection_index_id TO 3500;
SELECT helio_api.insert_one('db','aggregation_pipeline','{"_id":"1", "int": 10, "a" : { "b" : [ "x", 1, 2.0, true ] } }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','aggregation_pipeline','{"_...
               ^
SELECT helio_api.insert_one('db','aggregation_pipeline','{"_id":"2", "double": 2.0, "a" : { "b" : {"c": 3} } }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','aggregation_pipeline','{"_...
               ^
SELECT helio_api.insert_one('db','aggregation_pipeline','{"_id":"3", "boolean": false, "a" : "no", "b": "yes", "c": true }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','aggregation_pipeline','{"_...
               ^
-- fetch all rows
SELECT document FROM helio_api.collection('db', 'aggregation_pipeline') ORDER BY bson_get_value(document, '_id');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.collection('db', 'aggregation...
                             ^
-- add newField
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- do 2 addFields
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$addFields": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$set": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$addFields": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$set": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- add $project
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$set": { "newField2": "someOtherField" } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$set": { "newField2": "someOtherField" } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- add $unset
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unset": "_id" }, { "$set": { "newField2": "someOtherField" } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- add skip
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$skip": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$skip": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- add limit
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$limit": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$limit": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- add skip + limit
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$limit": 1 }, { "$skip": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$limit": 1 }, { "$skip": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$skip": 1 }, { "$limit": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id" : 1, "a.b": 1 } }, { "$skip": 1 }, { "$limit": 1 }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- try match
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match + project
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$project": { "a.b": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$project": { "a.b": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match + project + match
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$project": { "a.b": 1, "c": "$_id", "_id": 0 } }, { "$match": { "c": { "$gt": "2" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$project": { "a.b": 1, "c": "$_id", "_id": 0 } }, { "$match": { "c": { "$gt": "2" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- unwind
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match and then unwind
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$unwind": "$a.b" } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- unwind and then match
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" }, { "$match": { "$expr": { "$not": { "$isArray": "$a.b" } } } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- unwind and addfields
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" }, { "$addFields": { "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $addFields then addFields is inlined.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "x": 1, "y": 2, "xyz": 3 } }, { "$addFields": { "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON ) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "x": 1, "y": 2, "xyz": 3 } }, { "$addFields": { "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...AIN (COSTS OFF, VERBOSE ON ) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $project then addFields can be inlined only on exclusion today
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "a": 0, "boolean": 0 } }, { "$addFields": { "a": 1, "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON ) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "a": 0, "boolean": 0 } }, { "$addFields": { "a": 1, "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...AIN (COSTS OFF, VERBOSE ON ) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "a": 0, "boolean": 1 } }, { "$addFields": { "a": 1, "xyz": "$_id" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- replaceRoot
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "e": {  "f": "$a.b" } } }, { "$replaceRoot": { "newRoot": "$e" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- count
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$count": "d" }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" }, { "$count": "d" }, { "$addFields": { "e": "$d" } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- replaceWith
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "e": {  "f": "$a.b" } } }, { "$replaceWith": "$e" } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- sort
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sort": { "_id": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- sort + match
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sort": { "_id": 1 } }, { "$match": { "_id": { "$gt": "1" } } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match + sort
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "_id": { "$gt": "1" } } }, { "$sort": { "_id": 1 } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- sortByCount
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sortByCount": { "$eq": [ { "$mod": [ { "$toInt": "$_id" }, 2 ] }, 0  ] } }, { "$sort": { "_id": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $group
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$group": { "_id": { "$mod": [ { "$toInt": "$_id" }, 2 ] }, "d": { "$max": "$_id" }, "e": { "$count": 1 } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $group with first/last
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$group": { "_id": { "$mod": [ { "$toInt": "$_id" }, 2 ] }, "d": { "$first": "$_id" }, "e": { "$last":  "$_id" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$group": { "_id": { "$mod": [ { "$toInt": "$_id" }, 2 ] }, "d": { "$first": "$_id" }, "e": { "$last":  "$_id" } } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $group with first/last sorted (TODO)
-- add $sample
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sample": { "size": 2 } }, { "$project": { "_id": "1" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sample": { "size": 2 } }, { "$project": { "_id": "1" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- Sample after pass-through stages
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$project": { "_id": "1" } }, { "$sample": { "size": 2 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- Sample after sample
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$sample": { "size": 3 } }, { "$sample": { "size": 2 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- Sample after other stage
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" }, { "$sample": { "size": 2 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- internalInhibitOptimization
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$_internalInhibitOptimization": 1 }, { "$addFields": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } }, { "$_internalInhibitOptimization": 1 }, { "$addFields": { "newField2": "someOtherField" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- facet
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$facet": { "a" : [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$facet": { "a" : [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ],  "b" : [ { "$count": "c" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$facet": { "a" : [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ],  "b" : [ { "$count": "d" } ], "c": [ { "$unwind": "$a.b" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPlAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$facet": { "a" : [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ],  "b" : [ { "$count": "d" } ], "c": [ { "$unwind": "$a.b" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...lAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- facet with parent transform:
SELECT document FROM bson_aggregation_pipeline('db', 
'{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$unwind": "$a.b" }, { "$facet": { "a" : [ { "$unset": "_id" } ],  "b" : [ { "$count": "d" } ], "c": [ { "$replaceWith": { "f": "$_id" } } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- FIND
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "filter": { "_id": { "$gt": "1" } }, "projection": { "a.b": 1 }, "sort": { "_id": 1 }, "skip": 1, "limit": 2 }');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "filter": { "_id": { "$gt": "1" } }, "projection": { "a.b": 1 }, "sort": { "_id": 1 }, "skip": 1, "limit": 2 }');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- FIND with $natural
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": {}, "sort": { "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": {}, "sort": { "$natural": -1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": {}, "sort": { "$natural": 1, "$natural": -1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$natural": -1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- FIND with $natural when target is view
SELECT helio_api.create_collection_view('db', '{ "create": "targetView", "viewOn": "aggregation_pipeline", "pipeline": [ { "$project": { "_id": 1, "a" : 1 } } ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.create_collection_view('db', '{ "create": "...
               ^
SELECT document FROM bson_aggregation_find('db', '{ "find": "targetView", "projection": {}, "sort": { "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "targetView", "projection": {}, "sort": { "$natural": -1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $natural negative 
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$natural": "string" }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$natural": 2.12 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$natural": 3 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$natural": true }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": { "a.b": 1 }, "sort": { "$size":1, "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $natural EXPLAIN
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": {}, "sort": { "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- count
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline" }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": { "_id": { "$gt": "1" } } }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- count with skip
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": 0 }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": 1 }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": null }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": -3.14159 }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": -9223372036854775808 }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_count('db', '{ "count": "non_existent_coll" }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_count('db', '{ "count"...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM helio_api.count_query('db', '{ "count": "aggregation_pipeline", "query": { "_id": { "$gt": "1" } } }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.count_query('db', '{ "count":...
                             ^
SELECT document FROM helio_api.count_query('db', '{ "count": "aggregation_pipeline" }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.count_query('db', '{ "count":...
                             ^
SELECT document FROM helio_api.count_query('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": null }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.count_query('db', '{ "count":...
                             ^
SELECT document FROM helio_api.count_query('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": -3.14159 }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.count_query('db', '{ "count":...
                             ^
SELECT document FROM helio_api.count_query('db', '{ "count": "aggregation_pipeline", "query": {}, "skip": -9223372036854775808 }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.count_query('db', '{ "count":...
                             ^
-- handling of skip as an aggregation stage; this is different from skip in a count query
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [{ "$match": {}}, { "$skip": 0 }], "cursor": {}}');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [{ "$match": {}}, { "$skip": 1 }], "cursor": {}}');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [{ "$match": {}}, { "$skip": null }], "cursor": {}}');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [{ "$match": {}}, { "$skip": -3.14159 }], "cursor": {}}');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [{ "$match": {}}, { "$skip": -9223372036854775808 }], "cursor": {}}');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- EXPLAIN the counts
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline" }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_co...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_count('db', '{ "count": "aggregation_pipeline", "query": { "_id": { "$gt": "1" } } }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_co...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_count('db', '{ "count": "non_existent_coll" }');
ERROR:  function bson_aggregation_count(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_co...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- distinct
SELECT document FROM bson_aggregation_distinct('db', '{ "distinct": "aggregation_pipeline", "key": "_id" }');
ERROR:  function bson_aggregation_distinct(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_distinct('db', '{ "dis...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_distinct('db', '{ "distinct": "non_existent_coll", "key": "foo" }');
ERROR:  function bson_aggregation_distinct(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_distinct('db', '{ "dis...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM helio_api.distinct_query('db', '{ "distinct": "aggregation_pipeline", "key": "_id" }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.distinct_query('db', '{ "dist...
                             ^
SELECT document FROM helio_api.distinct_query('db', '{ "distinct": "non_existent_coll", "key": "foo" }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT document FROM helio_api.distinct_query('db', '{ "dist...
                             ^
-- Vector search with cosmosSearch
SELECT helio_api.insert_one('db', 'aggregation_pipeline', '{ "_id": 6, "a": "some sentence", "v": [3.0, 5.0, 1.1 ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline', '{...
               ^
SELECT helio_api.insert_one('db', 'aggregation_pipeline', '{ "_id": 7, "a": "some other sentence", "v": [8.0, 5.0, 0.1 ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline', '{...
               ^
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "aggregation_pipeline", "indexes": [ { "key": { "v": "cosmosSearch" }, "name": "foo_1", "cosmosSearchOptions": { "kind": "vector-ivf", "numLists": 2, "similarity": "COS", "dimensions": 3 } } ] }', true);
ERROR:  schema "helio_api_internal" does not exist
LINE 1: SELECT helio_api_internal.create_indexes_non_concurrently('d...
               ^
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "filter": {"a": "some sentence"} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "filter": "some sentence" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "filter": {} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- search with nProbes
-- numLists <= data size, using data as centroids, to avoid randomized centroids generated by pgvector
ANALYZE;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": 2 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
COMMIT;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": 1 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
COMMIT;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
COMMIT;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": 10000000 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": -5 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": "5" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- numLists > data size, pgvector will generate randomized centroids, using original vector data to query
CALL helio_api.drop_indexes('db', '{ "dropIndexes": "aggregation_pipeline", "index": "foo_1"}');
ERROR:  schema "helio_api" does not exist
LINE 1: CALL helio_api.drop_indexes('db', '{ "dropIndexes": "aggrega...
             ^
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "aggregation_pipeline", "indexes": [ { "key": { "v": "cosmosSearch" }, "name": "foo_1", "cosmosSearchOptions": { "kind": "vector-ivf", "numLists": 10000, "similarity": "COS", "dimensions": 3 } } ] }', true);
ERROR:  schema "helio_api_internal" does not exist
LINE 1: SELECT helio_api_internal.create_indexes_non_concurrently('d...
               ^
ANALYZE;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 2, "path": "v", "nProbes": 10000 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
COMMIT;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 5.0, 1.1 ], "k": 2, "path": "v", "nProbes": 1 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
COMMIT;
SELECT helio_test_helpers.drop_primary_key('db','aggregation_pipeline');
ERROR:  relation "helio_api_catalog.collections" does not exist
LINE 1: ...ELECT collection_id                          FROM helio_api_...
                                                             ^
QUERY:  SELECT collection_id                          FROM helio_api_catalog.collections
    WHERE collection_name = p_collection_name AND
          database_name = p_database_name
CONTEXT:  PL/pgSQL function helio_test_helpers.drop_primary_key(text,text) line 5 at SQL statement
BEGIN;
set local enable_seqscan to off;
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "nProbes": 1 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
ROLLBACK;
-- Vector search with knnBeta
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 5.0, 1.1 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "filter": {"a": "some sentence"} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "filter": "some" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 5.0, 1.1 ], "k": 1, "path": "v", "filter": {} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "score": {"a": "some sentence"} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v", "score": 100 }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "knnBeta": { "vector": [ 3.0, 5.0, 1.1 ], "k": 1, "path": "v", "score": {} }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$search": { "unknowType": { "vector": [ 3.0, 4.9, 1.0 ], "k": 1, "path": "v" }  } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- non supported vector index type
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "aggregation_pipeline_vector", "indexes": [ { "key": { "v": "cosmosSearch" }, "name": "idx_vector", "cosmosSearchOptions": { "kind": "vector-diskann", "similarity": "COS", "dimensions": 3 } } ] }');
ERROR:  schema "helio_api_internal" does not exist
LINE 1: SELECT helio_api_internal.create_indexes_non_concurrently('d...
               ^
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "aggregation_pipeline_vector", "indexes": [ { "key": { "v": "cosmosSearch" }, "name": "idx_vector", "cosmosSearchOptions": { "kind": "vector-scann", "similarity": "COS", "dimensions": 3 } } ] }');
ERROR:  schema "helio_api_internal" does not exist
LINE 1: SELECT helio_api_internal.create_indexes_non_concurrently('d...
               ^
-- $lookup
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 1, "item" : "almonds", "price" : 12, "quantity" : 2 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders','{ "_id" : 2, "item" : "pecans", "price" : 20, "quantity" : 1 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders','{ "_...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 3, "item" : "bread", "price" : 10, "quantity" : 5 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 4, "item" : ["almonds", "bread", "pecans"], "price" : 10, "quantity" : 5 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 5}', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 6, "item" : {"a": "x", "b" : 1, "c" : [1, 2, 3]} }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "_id" : 7, "item" : [{"a": { "b" : 1}}, [1, 2, 3], 1, "x"] }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_orders',' { "...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory',' { "_id" : 11, "sku" : "almonds", "description": "product 1", "instock" : 120 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory',' ...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory',' { "_id" : 12, "sku" : "almonds", "description": "product 1", "instock" : 240 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory',' ...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 13, "sku" : "bread", "description": "product 2", "instock" : 80 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 14, "sku" : "cashews", "description": "product 3", "instock" : 60 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 15, "sku" : "pecans", "description": "product 4", "instock" : 70 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 16, "sku" : null, "description": "product 4", "instock" : 70 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 17, "sku" :  {"a": "x", "b" : 1, "c" : [1, 2, 3]}, "description": "complex object" }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 18, "sku" : [{"a": { "b" : 1}}, [1, 2, 3], 1, "x"], "description": "complex array" }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT helio_api.insert_one('db','agg_pipeline_inventory','{ "_id" : 19, "sku" : [{"a": { "b" : 1}}, [1, 2, 3], 1, "x"], "description": "complex array" }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','agg_pipeline_inventory','{...
               ^
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } }, { "$sample": { "size": 3 } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "coll_dne", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "colldne", "pipeline": [], "as": "c" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
BEGIN;
set local citus.enable_local_execution to off;
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
ROLLBACK;
SELECT helio_api.shard_collection('db', 'agg_pipeline_orders', '{ "_id": "hashed" }', false);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.shard_collection('db', 'agg_pipeline_orders...
               ^
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
--$natural with shared collection
SELECT document FROM bson_aggregation_find('db', '{ "find": "agg_pipeline_inventory", "projection": {}, "sort": { "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $natural with shared collection EXPLAIN
EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "projection": {}, "sort": { "$natural": 1 }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: ...LAIN (COSTS OFF, VERBOSE ON) SELECT document FROM bson_aggre...
                                                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
BEGIN;
set local citus.enable_local_execution to off;
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
ROLLBACK;
SELECT helio_api.shard_collection('db', 'agg_pipeline_inventory', '{ "_id": "hashed" }', false);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.shard_collection('db', 'agg_pipeline_invent...
               ^
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "agg_pipeline_inventory", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "coll_dne", "as": "matched_docs", "localField": "item", "foreignField": "sku", "pipeline": [ { "$count": "efe" } ] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', 
    '{ "aggregate": "agg_pipeline_orders", "pipeline": [ { "$lookup": { "from": "colldne", "pipeline": [], "as": "c" } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', 
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": 1, "pipeline": [ { "$addFields": { "newField" : "1", "a.y": ["p", "q"] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": 1, "pipeline": [ { "$match": { "newField" : "1", "a.y": ["p", "q"] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": 1, "pipeline": [ { "$project": { "newField" : "1", "a.y": ["p", "q"] } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": 1, "pipeline": [ { "$skip": 1 } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- test sort behavior on sharded/unsharded
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate" : "agg_pipeline_inventory", "pipeline" : [ { "$match" : { "$or" : [ { "_id" : { "$lt" : 9999.0 }, "some_other_field" : { "$ne" : 3.0 } }, { "this_predicate_matches_nothing" : true } ] } }, { "$sort" : { "_id" : -1.0 } }, { "$limit" : 1.0 }, { "$project" : { "_id" : 1.0, "b" : { "$round" : "$a" } } } ], "cursor" : {  }, "lsid" : { "id" : { "$binary" : { "base64": "VJmzOaS5R46C4aFkQzrFaQ==", "subType" : "04" } } }, "$db" : "test" }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate" : "aggregation_pipeline", "pipeline" : [ { "$match" : { "$or" : [ { "_id" : { "$lt" : 9999.0 }, "some_other_field" : { "$ne" : 3.0 } }, { "this_predicate_matches_nothing" : true } ] } }, { "$sort" : { "_id" : -1.0 } }, { "$limit" : 1.0 }, { "$project" : { "_id" : 1.0, "b" : { "$round" : "$a" } } } ], "cursor" : {  }, "lsid" : { "id" : { "$binary" : { "base64": "VJmzOaS5R46C4aFkQzrFaQ==", "subType" : "04" } } }, "$db" : "test" }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- Vector search with empty vector field
SELECT helio_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "aggregation_pipeline_empty_vector", "indexes": [ { "key": { "v": "cosmosSearch" }, "name": "vectorIndex", "cosmosSearchOptions": { "kind": "vector-ivf", "numLists": 5, "similarity": "COS", "dimensions": 3 } } ] }', true);
ERROR:  schema "helio_api_internal" does not exist
LINE 1: SELECT helio_api_internal.create_indexes_non_concurrently('d...
               ^
SELECT helio_api.insert_one('db', 'aggregation_pipeline_empty_vector', '{ "_id": 1, "a": "some sentence", "v": [1, 2, 3 ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline_empt...
               ^
SELECT helio_api.insert_one('db', 'aggregation_pipeline_empty_vector', '{ "_id": 2, "a": "some other sentence", "v": [1, 2.0, 3 ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline_empt...
               ^
SELECT helio_api.insert_one('db', 'aggregation_pipeline_empty_vector', '{ "_id": 3, "a": "some sentence" }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline_empt...
               ^
SELECT helio_api.insert_one('db', 'aggregation_pipeline_empty_vector', '{ "_id": 4, "a": "some other sentence", "v": [3, 2, 1 ] }');
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db', 'aggregation_pipeline_empt...
               ^
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline_empty_vector", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 4, "path": "v", "nProbes": 5 }  } }, { "$project": { "rank": {"$round":[{"$multiply": [{"$meta": "searchScore" }, 100000]}]} } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF)SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline_empty_vector", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 4, "path": "v", "nProbes": 5 }  } }, { "$project": { "rank": {"$round":[{"$multiply": [{"$meta": "searchScore" }, 100000]}]} } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
COMMIT;
ANALYZE;
BEGIN;
SET LOCAL enable_seqscan = off;
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline_empty_vector", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 4, "path": "v", "nProbes": 5 }  } }, { "$project": { "rank": {"$round":[{"$multiply": [{"$meta": "searchScore" }, 100000]}]} } } ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF)SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline_empty_vector", "pipeline": [ { "$search": { "cosmosSearch": { "vector": [ 3.0, 4.9, 1.0 ], "k": 4, "path": "v", "nProbes": 5 }  } }, { "$project": { "rank": {"$round":[{"$multiply": [{"$meta": "searchScore" }, 100000]}]} } } ], "cursor": {} }');
ERROR:  current transaction is aborted, commands ignored until end of transaction block
COMMIT;
SELECT drop_collection('db','aggregation_pipeline_empty_vector');
ERROR:  function drop_collection(unknown, unknown) does not exist
LINE 1: SELECT drop_collection('db','aggregation_pipeline_empty_vect...
               ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- $addFields nested usage
SELECT helio_api.insert_one('db','aggregation_pipeline','{ "_id": 100, "student": "Maya", "homework": [10, 5, 10], "quiz": [10, 8], "extraCredit": 0 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','aggregation_pipeline','{ "...
               ^
SELECT helio_api.insert_one('db','aggregation_pipeline','{ "_id": 200, "student": "Ryan", "homework": [5, 6, 5], "quiz": [8, 8], "extraCredit": 8 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','aggregation_pipeline','{ "...
               ^
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline": [ { "$match": { "extraCredit": { "$gte": 0 } } }, { "$addFields": { "totalHomework": { "$sum": "$homework" }, "totalQuiz": { "$sum": "$quiz" } }}, { "$addFields": { "totalScore": { "$add": [ "$totalHomework", "$totalQuiz", "$extraCredit" ]} }} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match + samplerate
/* insert 100 documents */
/* test unshard case */
DO $$
DECLARE i int;
BEGIN
FOR i IN 1..100 LOOP
PERFORM helio_api.insert_one('db', 'agg_pipeline_samplerate', FORMAT('{ "_id": %s }',i)::helio_core.bson);
END LOOP;
END;
$$;
ERROR:  schema "helio_core" does not exist
LINE 1: ..._pipeline_samplerate', FORMAT('{ "_id": %s }',i)::helio_core...
                                                             ^
QUERY:  SELECT helio_api.insert_one('db', 'agg_pipeline_samplerate', FORMAT('{ "_id": %s }',i)::helio_core.bson)
CONTEXT:  PL/pgSQL function inline_code_block line 5 at PERFORM
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 1 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 1 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
/* sampleRate will random select document, use greater than 0 to make sure slice of documents is selected */
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0.5 } }, { "$count": "numMatches" }, { "$addFields": { "gtZero": { "$gt": ["$numMatches", 0] } } }, {"$project": { "_id": 0, "gtZero": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 2: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0.5 } }, { "$count": "numMatches" }, { "$addFields": { "gtZero": { "$gt": ["$numMatches", 0] } } }, {"$project": { "_id": 0, "gtZero": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
/* test shard case */
SELECT helio_api.shard_collection('db', 'agg_pipeline_samplerate', '{ "_id": "hashed" }', false);
ERROR:  schema "helio_api" does not exist
LINE 2: SELECT helio_api.shard_collection('db', 'agg_pipeline_sample...
               ^
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 1 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 1 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0 } }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: EXPLAIN (COSTS OFF) SELECT document FROM bson_aggregation_pi...
                                                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
/* sampleRate will random select document, use greater than 0 to make sure slice of documents is selected */
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 0.5 } }, { "$count": "numMatches" }, { "$addFields": { "gtZero": { "$gt": ["$numMatches", 0] } } }, {"$project": { "_id": 0, "gtZero": 1 } }], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 2: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- negative samplerate
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": -1.23 } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": null } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": NaN } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": Infinity } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": -Infinity } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": "0.65" } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": 10 } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "agg_pipeline_samplerate", "pipeline": [ { "$match": { "$sampleRate": false } }, { "$limit": 1 }, {"$count": "count"} ], "cursor": {} }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
-- match/find with $comment
SELECT document FROM bson_aggregation_find('db', '{ "find": "aggregation_pipeline", "filter": { "_id": "1", "$comment": "finding id 1" }}');
ERROR:  function bson_aggregation_find(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_find('db', '{ "find": ...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
SELECT document FROM bson_aggregation_pipeline('db', '{ "aggregate": "aggregation_pipeline", "pipeline":[ { "$match": { "_id": "1", "$comment": "finding id 1" } } ] }');
ERROR:  function bson_aggregation_pipeline(unknown, unknown) does not exist
LINE 1: SELECT document FROM bson_aggregation_pipeline('db', '{ "agg...
                             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
