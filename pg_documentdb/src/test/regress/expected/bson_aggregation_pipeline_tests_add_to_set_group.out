SET search_path TO helio_api,helio_core,helio_api_catalog;
SET citus.next_shard_id TO 12200;
SET helio_api.next_collection_id TO 12200;
SET helio_api.next_collection_index_id TO 12200;
SELECT helio_api.insert_one('db','sales',' { "_id" : 1, "item" : "almonds", "pricing" : { "wholesale": 10, "retail": 15 }, "quantity" : 2, "year": 2020 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales',' { "_id" : 1, "ite...
               ^
SELECT helio_api.insert_one('db','sales','{ "_id" : 2, "item" : "pecans", "pricing" : { "wholesale": 10, "retail": 9 }, "quantity" : 1, "year": 2021 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales','{ "_id" : 2, "item...
               ^
SELECT helio_api.insert_one('db','sales',' { "_id" : 3, "item" : "bread", "pricing" : { "wholesale": 10, "retail": 15 }, "quantity" : 5 , "year": 2020}', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales',' { "_id" : 3, "ite...
               ^
SELECT helio_api.insert_one('db','sales',' { "_id" : 4, "item" : "meat", "pricing" : { "wholesale": 4, "retail": 10 }, "quantity" : 3 , "year": 2022}', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales',' { "_id" : 4, "ite...
               ^
SELECT helio_api.insert_one('db','sales','{ "_id" : 5, "item" : "bread", "pricing" : { "wholesale": 75, "retail": 100 }, "quantity" : 1, "year": 2021 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales','{ "_id" : 5, "item...
               ^
SELECT helio_api.insert_one('db','sales','{ "_id" : 6, "item" : "bread", "pricing" : { "wholesale": 75, "retail": 100 }, "quantity" : 1, "year": 2021 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales','{ "_id" : 6, "item...
               ^
SELECT helio_api.insert_one('db','sales','{ "_id" : 7, "item" : "bread", "pricing" : { "retail": 15, "wholesale": 10 }, "quantity" : 1, "year": 2020 }', NULL);
ERROR:  schema "helio_api" does not exist
LINE 1: SELECT helio_api.insert_one('db','sales','{ "_id" : 7, "item...
               ^
/* running multiple $addToSet accumulators with different expressions */
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": { "item" : "$item" } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 2: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": "$item" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "pricingDeals": { "$addToSet": "$pricing" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$pricing.retail" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$noValue" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "items": { "$addToSet": { "$getField": { "field": "a", "input": { "b": 1 } } } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": { "item" : "$item" } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": "$item" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "pricingDeals": { "$addToSet": "$pricing" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$pricing.retail" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$noValue" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "items": { "$addToSet": { "$getField": { "field": "a", "input": { "b": 1 } } } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
/* running $addToSet with document that exceeds 16MB */
DO $$
DECLARE i int;
BEGIN
-- each doc is "c": 5 MB - ~5.5 MB & there's 25 of them
FOR i IN 1..25 LOOP
PERFORM helio_api.insert_one('db', 'sizes_test', FORMAT('{ "_id": %s, "groupName": "A", "c": [ %s "d" ] }', i, repeat('"' || i || repeat('a', 1000) || '", ', 5000))::helio_core.bson);
END LOOP;
END;
$$;
ERROR:  schema "helio_core" does not exist
LINE 1: ...t('"' || i || repeat('a', 1000) || '", ', 5000))::helio_core...
                                                             ^
QUERY:  SELECT helio_api.insert_one('db', 'sizes_test', FORMAT('{ "_id": %s, "groupName": "A", "c": [ %s "d" ] }', i, repeat('"' || i || repeat('a', 1000) || '", ', 5000))::helio_core.bson)
CONTEXT:  PL/pgSQL function inline_code_block line 6 at PERFORM
/* should fail with intermediate size error */
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sizes_test", "pipeline": [ { "$group": { "_id": "$groupName", "data": { "$addToSet": "$c" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 2: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
/* shard collection */
SELECT helio_api.shard_collection('db', 'sales', '{ "_id": "hashed" }', false);
ERROR:  schema "helio_api" does not exist
LINE 2: SELECT helio_api.shard_collection('db', 'sales', '{ "_id": "...
               ^
/* run same $addToSet queries to ensure consistency */
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": { "item" : "$item" } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 2: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": "$item" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "pricingDeals": { "$addToSet": "$pricing" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$pricing.retail" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$noValue" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "items": { "$addToSet": { "$getField": { "field": "a", "input": { "b": 1 } } } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: SELECT document FROM helio_api_catalog.bson_aggregation_pipe...
                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": { "item" : "$item" } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "itemsSold": { "$addToSet": "$item" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "pricingDeals": { "$addToSet": "$pricing" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$pricing.retail" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "retailPrices": { "$addToSet": "$noValue" } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
EXPLAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_catalog.bson_aggregation_pipeline('db', '{ "aggregate": "sales", "pipeline": [ { "$group": { "_id": "$year", "items": { "$addToSet": { "$getField": { "field": "a", "input": { "b": 1 } } } } } } ] }');
ERROR:  schema "helio_api_catalog" does not exist
LINE 1: ...LAIN (VERBOSE ON, COSTS OFF) SELECT document FROM helio_api_...
                                                             ^
